webpackJsonp([1],{"15Jx":function(t,e){},"1d6v":function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("VCXJ"),i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var a=n("Mw9A")({name:"app"},i,!1,function(t){n("15Jx")},null,null).exports,s=n("zO6J"),r=n("6fg8"),d=n.n(r),c={name:"contextMenu",props:{items:Array,position:{}},data:function(){return{}},methods:{chooseItem:function(t){this.$emit("chooseItem",t)},stopBubble:function(){return!1}}},h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"contextMenu-Container",on:{click:function(e){e.stopPropagation(),t.stopBubble(e)}}},[n("ul",t._l(t.items,function(e){return n("li",{key:e.value,on:{click:function(n){t.chooseItem(e.value)}}},[t._v(t._s(e.name))])}))])},staticRenderFns:[]};var l={data:[{name:"机器人",condition:"",type:"image",src:"static/img/robot.png",id:"1",children:[{name:"普通节点",condition:"",id:"11",children:[{name:"sddd",condition:"ss，ss",id:"1-1-1",children:[{name:"普通节点",condition:"是",id:"1-1-1-1",children:[{name:"普通节点",condition:"条件一",id:"1-1-1-1-1"},{name:"普通节点",condition:"条件二",id:"1-1-1-1-2",children:[{name:"END",type:"stop",condition:"否",id:"1-1-1-1-2-1"}]},{name:"普通节点",condition:"条件三",id:"1-1-1-1-3"}]},{name:"普通节点",condition:"否",id:"1-1-1-2",children:[{name:"END",type:"stop",id:"1-1-1-3",condition:"否"}]},{name:"普通节点",id:"1-1-1-3",condition:"不理解"}]},{name:"END",type:"stop",condition:"否",id:"1-1-2"}]}]}]},u={components:{contextMenu:n("Mw9A")(c,h,!1,function(t){n("OFTl")},"data-v-48070327",null).exports},data:function(){return{svgInstance:{},fontSize:14,conditionFontSize:14,horizonSpace:200,verticalSpace:40,rootPosition:{x:50,y:0},selectedNode:{},data:l.data,menuList:[{name:"新增子节点",value:1},{name:"删除子节点",value:2},{name:"编辑子节点",value:3}],showContextMenu:!1,contextMenuIndex:"",contextMenuNode:{},showEditNode:!1,nodeAttr:{nodeName:"",voiceContent:"",message:"",modelId:"",result:""},root:[],containerWH:{width:"100%",height:"100%"},loadingFun:function(){},modifyConditionNode:!1,modifyConditionNodeName:{oldName:"",nodeName:""},currentConditionNode:{},scale:1,showStartBtn:!1,editNode:{}}},methods:{Node:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",r=(arguments.length>7&&void 0!==arguments[7]&&arguments[7],arguments.length>8&&void 0!==arguments[8]?arguments[8]:"normal"),d={},c=this.getStrBytes(t)*this.fontSize/2+20,h=this.fontSize+20;return d.value=t,d.no=e,d.x=i,d.y=a,d.width=c,d.height=h,d.leafCount=o,d.condition=n,d.children=[],d.type=r,d.content=s,d},ConditionNode:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e={},n=this.getStrBytes(t)*(this.conditionFontSize+2)/2+5,o=this.conditionFontSize+10;return e.value=t,e.width=n,e.height=o,e},CircleNode:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"stop",a={};return a.value=t,a.x=e,a.y=n,a.r=20,a.condition=o,a.type=i,a},ImageNode:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.rootPosition.x,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.rootPosition.y,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:50,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:45,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"image",c={};return c.value=t,c.src=e,c.x=i,c.y=a,c.leafCount=n,c.children=o,c.width=s,c.height=r,c.type=d,c},getLeafCount:function(t){var e=this,n=0;return t.forEach(function(t){if("stop"!==t.type)if(!t.children||0===t.children.length||1===t.children.length&&"stop"===t.children[0].type)e.$set(t,"leafCount",0),n+=1;else if(t.children.length>0){var o=e.getLeafCount(t.children);e.$set(t,"leafCount",o),n+=o}}),n},getStrBytes:function(t){return t.replace(/[^\x00-\xff]/g,"aa").length},drawNode:function(t){var e=this.svgInstance.text(t.x+10,t.y+this.fontSize+8,t.value).attr({fontSize:this.fontSize,fill:"#333333"}),n=e.node.getBBox();t.width=n.width+20;var o=this.svgInstance.rect(t.x,t.y,t.width,t.height,2);o.attr({fill:"#fff",stroke:"#333333",strokeWidth:1});var i=this.svgInstance.g();return i.add(o,e),i.addClass("node _"+t.no),i.attr({cursor:"pointer"}),i.node.onclick=this.onNodeClick(i,t,o),i.node.oncontextmenu=this.onContextMenu(i,t,o),t},onNodeClick:function(t,e,n){var o=this;return function(){d.a.selectAll(".active rect").attr({stroke:"#c7d3e1"}),t.addClass("active"),n.attr({stroke:"#198ae0"}),o.selectedNode=e}},onContextMenu:function(t,e,n){var o=this;return function(){return d.a.selectAll(".active rect").attr({stroke:"#c7d3e1"}),t.addClass("active"),n.attr({stroke:"#198ae0"}),o.showContextMenu=!0,o.contextMenuNode=e,o.contextMenuIndex=0,o.$nextTick(function(){document.querySelector(".contextMenu-Container").style.left=event.clientX-200+"px",document.querySelector(".contextMenu-Container").style.top=event.clientY-10+"px"}),!1}},drawConditionNode:function(t,e){var n=this,o=this.ConditionNode(e.condition);"stop"===e.type&&0===t.leafCount?(o.x=e.x-this.horizonSpace/4-e.r,o.y=t.y+6):"stop"===e.type&&t.leafCount>0?(o.x=e.x-o.width/2,o.y=t.y-this.horizonSpace/2):t.y===e.y&&t.leafCount===e.leafCount?(o.x=e.x-this.horizonSpace/2-o.width/2,o.y=e.y+6):(o.x=e.x-3*this.horizonSpace/8-o.width/2,o.y=e.y+6);var i=this.svgInstance.text(o.x+5,o.y+this.fontSize+2,o.value).attr({fontSize:this.conditionFontSize,fill:"#022a46"}),a=i.node.getBBox();o.width=a.width+10;var s=this.svgInstance.rect(o.x,o.y,o.width,o.height,2);s.attr({fill:"#c7d3e1"});var r=this.svgInstance.g();return r.add(s,i),r.addClass("conditionNode _"+e.no),r.attr({cursor:"pointer"}),r.node.ondblclick=function(){n.modifyConditionNode=!0,n.$nextTick(function(){n.$refs.modifyConditionNodeName.resetFields(),n.currentConditionNode=e,n.modifyConditionNodeName.oldName=e.condition})},o},drawStopNode:function(t){var e=this.svgInstance.circle(t.x,t.y,t.r);e.attr({fill:"#d53737"});var n=this.svgInstance.text(t.x-this.fontSize,t.y+this.fontSize/2-1,t.value).attr({fontSize:this.conditionFontSize,fill:"#fff"});return this.svgInstance.g().add(e,n),t},drawImageNode:function(t){var e=this.svgInstance.image(t.src,t.x,t.y,t.width,t.height),n=this.svgInstance.text(t.x+10,t.y+t.height+20,t.value).attr({fontSize:this.conditionFontSize,fill:"#333333"});return this.svgInstance.g().add(e,n),t},drawLine:function(t,e){var n="";"normal"===t.type&&"normal"===e.type?n="M"+(t.x+t.width)+" "+(t.y+t.height/2)+"\n                L"+(t.x+t.width+this.horizonSpace/4)+" "+(t.y+t.height/2)+"\n                M"+(t.x+t.width+this.horizonSpace/4)+" "+(t.y+t.height/2)+"\n                L"+(t.x+t.width+this.horizonSpace/4)+" "+(e.y+e.height/2)+"\n                M"+(t.x+t.width+this.horizonSpace/4)+" "+(e.y+e.height/2)+"\n                L"+e.x+" "+(e.y+e.height/2):"stop"===e.type&&0===t.leafCount?n="M"+(t.x+t.width)+" "+(t.y+t.height/2)+"\n                L"+e.x+" "+e.y:"stop"===e.type&&t.leafCount>0?n="M"+(t.x+t.width/2)+" "+t.y+"\n                L"+e.x+" "+e.y:"image"===t.type&&(n="M"+(t.x+t.width+3)+" "+(e.y+e.height/2)+"\n                L"+e.x+" "+(e.y+e.height/2));this.svgInstance.path(n).attr({stroke:"#333333",strokeWidth:1,"stroke-dasharray":"2, 2"}),e.condition&&this.drawConditionNode(t,e)},transformData:function(t,e){var n=this,o=null,i=0;if(null===e){if(o=this.ImageNode(t[0].name,t[0].src,t[0].leafCount),(i=o.y-(o.leafCount-1)*(o.height+this.verticalSpace)/2)<0)return this.rootPosition.y-=i,null;t=t[0].children,this.transformData(t,o)}else{var a=(o=e).x+o.width+this.horizonSpace;i=o.y-(o.leafCount-1)*(o.height+this.verticalSpace)/2,t.forEach(function(t,e){if(t.type&&"stop"===t.type)if(o.leafCount>0){var s=n.CircleNode(t.name,o.x+o.width/2,o.y-n.horizonSpace,t.condition);o.children.push(s)}else{var r=n.CircleNode(t.name,a-n.horizonSpace/2,o.y+o.height/2,t.condition);o.children.push(r)}else{var d=0,c=0===t.leafCount?1:t.leafCount;if(0===e)d=i+(c-1)*(o.height+n.verticalSpace)/2;else{var h=o.children[e-1],l=0===h.leafCount?1:h.leafCount;d=h.y+(l+1)*(h.height+n.verticalSpace)/2+(c-1)*(o.height+n.verticalSpace)/2}var u=n.Node(t.name,t.no,t.condition,t.leafCount,a,d,t.content);o.children.push(u),t.children&&t.children.length>0&&n.transformData(t.children,u)}})}return o},drawFlowChart:function(t){var e=this;"normal"===t.type?this.drawNode(t):"stop"===t.type?this.drawStopNode(t):"image"===t.type&&this.drawImageNode(t),t.children&&t.children.length>0&&t.children.forEach(function(n){e.drawLine(t,n),e.drawFlowChart(n)})},initSVG:function(){this.svgInstance=d()("#svgContainer"),window.test=this.svgInstance,this.svgInstance.drag(),this.getLeafCount(this.data),this.root=this.transformData(this.data,null),null===this.root&&(this.root=this.transformData(this.data,null)),this.drawFlowChart(this.root)},chooseItem:function(t){this.showContextMenu=!1,this.contextMenuIndex=t,1===this.contextMenuIndex?this.contextMenuNode.value=1:2===this.contextMenuIndex?console.log("删除子节点"):3===this.contextMenuIndex&&(this.showEditNode=!0,this.nodeAttr.nodeName=this.contextMenuNode.value,this.nodeAttr.voiceContent=this.contextMenuNode.content,this.nodeAttr.message=this.contextMenuNode.message,this.editNode=this.contextMenuNode)},hideContextMenu:function(){this.showContextMenu=!1},submitEditNode:function(){this.changeNodeView()},changeNodeView:function(){this.showEditNode=!1,this.contextMenuNode.value=this.nodeAttr.nodeName,this.contextMenuNode.content=this.nodeAttr.voiceContent,this.contextMenuNode.message=this.nodeAttr.message;var t=".node._"+this.contextMenuNode.no+" text";this.svgInstance.select(t).node.innerHTML=this.nodeAttr.nodeName;var e=".node._"+this.contextMenuNode.no+" rect";this.svgInstance.select(e).node.style.width=this.getStrBytes(this.nodeAttr.nodeName)*this.fontSize/2+20},zoomInOut:function(t){var e=this.svgInstance.node.transform.animVal[0]&&this.svgInstance.node.transform.animVal[0].matrix||new d.a.Matrix(1,0,0,1,0,0),n=[e.a,e.b,e.c,e.d,e.e,e.f],o=n[0],i=n[1],a=n[2],s=n[3],r=n[4],c=n[5];t&&t.wheelDelta>0?o+=.1:t&&t.wheelDelta<0&&o>=.3&&(o-=.1),s=o;var h=new d.a.Matrix(o,i,a,s,r,c);this.svgInstance.transform(h)},submitNodeName:function(){this.modifyConditionNode=!1,this.currentConditionNode.condition=this.modifyConditionNodeName.nodeName;var t=".conditionNode._"+this.currentConditionNode.no+" text",e=".conditionNode._"+this.currentConditionNode.no+" rect",n=this.svgInstance.select(t),o=this.svgInstance.select(e);n.node.innerHTML=this.modifyConditionNodeName.nodeName,o.node.style.width=this.getStrBytes(this.modifyConditionNodeName.nodeName)*(this.conditionFontSize+2)/2+10},cancel:function(){this.modifyConditionNode=!1},startProcess:function(){var t=this;this.axios.get("/orderMessage/guahao.do").then(function(e){t.loadingFun(),"1"===e.data.returnCode?t.$Message.success("流程开启成功"):t.$Message.error("流程开启失败")})}},mounted:function(){this.initSVG(),document.onclick=this.hideContextMenu,~this.$route.path.indexOf("data2")?this.showStartBtn=!0:this.showStartBtn=!1}},v={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"config-container",on:{mousewheel:t.zoomInOut}},[t.showStartBtn?n("Button",{staticClass:"startProcess",attrs:{type:"primary",size:"large"},on:{click:t.startProcess}},[t._v("开始流程")]):t._e(),t._v(" "),n("svg",{staticClass:"svgContainer",attrs:{id:"svgContainer"}}),t._v(" "),t.showContextMenu?n("context-menu",{attrs:{items:t.menuList},on:{chooseItem:t.chooseItem}}):t._e(),t._v(" "),n("transition",{attrs:{name:"fade"}},[t.showEditNode?n("div",{staticClass:"editNodeAttr"},[n("div",{staticClass:"title"},[n("h3",[t._v("编辑属性值")])]),t._v(" "),n("div",{staticClass:"formContent"},[n("Form",{ref:"nodeAttr",attrs:{model:t.nodeAttr,"label-width":100}},[n("Form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"节点名称",prop:"nodeName"}},[n("Input",{model:{value:t.nodeAttr.nodeName,callback:function(e){t.$set(t.nodeAttr,"nodeName",e)},expression:"nodeAttr.nodeName"}})],1),t._v(" "),n("Form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"语音内容",prop:"voiceContent"}},[n("Input",{attrs:{rows:5,type:"textarea",placeholder:"请输入..."},model:{value:t.nodeAttr.voiceContent,callback:function(e){t.$set(t.nodeAttr,"voiceContent",e)},expression:"nodeAttr.voiceContent"}})],1),t._v(" "),n("Form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"模型版本",prop:"modelId"}},[n("Select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:t.nodeAttr.modelId,callback:function(e){t.$set(t.nodeAttr,"modelId",e)},expression:"nodeAttr.modelId"}},[n("Option",{key:1,attrs:{value:"ID001"}},[t._v(t._s(t.nodeAttr.nodeName+" v0.1.1"))]),t._v(" "),n("Option",{key:2,attrs:{value:"ID002"}},[t._v(t._s(t.nodeAttr.nodeName+" v0.1.2"))]),t._v(" "),n("Option",{key:3,attrs:{value:"ID003"}},[t._v(t._s(t.nodeAttr.nodeName+" v0.1.3"))])],1)],1),t._v(" "),0===t.editNode.leafCount?n("Form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"短信内容",prop:"message"}},[n("Input",{attrs:{rows:5,type:"textarea",placeholder:"请输入..."},model:{value:t.nodeAttr.message,callback:function(e){t.$set(t.nodeAttr,"message",e)},expression:"nodeAttr.message"}})],1):t._e(),t._v(" "),0===t.editNode.leafCount?n("Form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"处理结果",prop:"result"}},[n("Select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:t.nodeAttr.result,callback:function(e){t.$set(t.nodeAttr,"result",e)},expression:"nodeAttr.result"}},[n("Option",{attrs:{value:"1"}},[t._v("同意")]),t._v(" "),n("Option",{attrs:{value:"0"}},[t._v("拒绝")])],1)],1):t._e(),t._v(" "),n("Form-item",{staticClass:"controller"},[n("Button",{attrs:{type:"primary"},on:{click:t.submitEditNode}},[t._v("确认修改")]),t._v(" "),n("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"ghost"},on:{click:function(e){t.showEditNode=!1}}},[t._v("取消")])],1)],1)],1)]):t._e()])],1)},staticRenderFns:[]};var m=n("Mw9A")(u,v,!1,function(t){n("1d6v")},"data-v-d126ff1e",null).exports;o.a.use(s.a);var f=new s.a({routes:[{path:"/",name:"Demo",component:m}]});o.a.config.productionTip=!1,new o.a({el:"#app",router:f,template:"<App/>",components:{App:a}})},OFTl:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.6617df12da4f2e5de3a4.js.map